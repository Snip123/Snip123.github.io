import{Q,e as E}from"./QBtn-TpKigmME.js";import{_ as X,Q as Y,P as L,a as Z,b as q,c as p,d as v,e as C,f as ee,g as F}from"./_plugin-vue_export-helper-aFHPHLYy.js";import{a as le}from"./index-BtuGy7By.js";import{r as u,o as ae,I as te,J as m,K as r,V as e,M as n,R as A,L as D,S as ne,T as ue,O as s}from"./index-DSfz9zp_.js";import"./QItem-CdtyeZhg.js";const oe={class:"price-inputs"},re={class:"price-inputs-group"},se={class:"csv-upload"},ie={key:0,class:"csv-table"},de={class:"csv-buttons"},ce={class:"calculate-button"},pe={class:"part-details"},ve={class:"price-outputs"},me={key:0,class:"image-preview"},fe=["src"],ge={__name:"AdvancedPage",setup(be){const N=le.create({baseURL:"https://scs-cnc-cost-estimator.wm.r.appspot.com//"}),f=u(1.4),g=u(4.2),b=u(4),P=u(50),S=u(21),I=u(),T=u(!1),V=u(),i=u([]),x=u(""),d=u({totalBoundingBoxArea:"",finalPartTotalSurfaceArea:"",boundingBoxAreaCost:"",partSurfaceAreaCost:"",billetWeight:"",partWeight:"",weightRatio:""}),h=u({pricePerSqIn:"",machiningTotal:"",materialTotal:"",totalPrice:""}),R=()=>{console.log("file uploaded")},O=()=>{if(console.log("csv uploaded"),V.value){const a=new FileReader;a.onload=l=>{const t=l.target.result;L.parse(t,{header:!0,skipEmptyLines:!0,complete:c=>{i.value=c.data.map(w=>[w["Square Inches"],w.Price])}})},a.readAsText(V.value),console.log(i.value)}},o=a=>a?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a):"",y=a=>a?parseFloat(a.replace(/[^0-9.-]+/g,"")):0,B=u(o(f.value)),_=u(o(g.value)),k=u(b.value),U=u(o(P.value)),M=u(o(S.value)),W=a=>{console.log("updating billet surface area price"),f.value=y(a),B.value=o(f.value)},J=a=>{g.value=y(a),_.value=o(g.value)},$=a=>{b.value=parseFloat(a),k.value=b.value},j=a=>{P.value=y(a),U.value=o(P.value)},G=a=>{S.value=y(a),M.value=o(S.value)},K=async()=>{T.value=!0,console.log("calculating costs"),console.log(JSON.stringify(i.value));try{console.log("calculating costs");const a=new FormData;a.append("billetSurfaceAreaPrice",f.value),a.append("surfaceAreaPriceTable",JSON.stringify(i.value)),a.append("materialPricePerLb",g.value),a.append("materialMarkup",b.value),a.append("setupPrice",P.value),a.append("shippingEst",S.value),a.append("stepFile",I.value);const l=await N.post("/advancedCalculations",a,{headers:{"Content-Type":"multipart/form-data"}});l.data.image&&(x.value=`data:image/png;base64,${l.data.image}`),console.log(l.data)}catch(a){console.error("Error calculating costs:",a)}finally{T.value=!1}},z=()=>{L.parse(`1,4.55
5,4.55
10,4.52
15,4.37
20,4.07
25,3.72
30,3.42
35,3.12
40,2.82
45,2.52
50,2.22
55,1.92
60,1.62
65,1.32
70,1.12
75,0.92
80,0.72
85,0.62
90,0.57
95,0.56
100,0.55
105,0.54
110,0.53
115,0.52
120,0.51
125,0.50
130,0.49
135,0.48
140,0.47
145,0.47
150,0.47
155,0.47
160,0.47
165,0.47
170,0.47
175,0.47
180,0.47
185,0.47
190,0.47
195,0.47
200,0.47`,{complete:l=>{i.value=l.data}})},H=()=>{const a=`data:text/csv;charset=utf-8,Square Inches,Price
`+i.value.map(c=>c.join(",")).join(`
`),l=encodeURI(a),t=document.createElement("a");t.setAttribute("href",l),t.setAttribute("download","price_table.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)};return ae(()=>{z()}),(a,l)=>(m(),te(Y,{class:"flex flex-center"},{default:r(()=>[e("div",null,[n(Z,{onSubmit:K},{default:r(()=>[n(q,{outline:"",modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=t=>I.value=t),label:"Upload .STEP file",onChange:l[1]||(l[1]=t=>R())},{prepend:r(()=>[n(Q,{name:"attach_file"})]),_:1},8,["modelValue"]),e("div",oe,[l[9]||(l[9]=e("label",{class:"price-inputs-label"},"Advanced Price Inputs",-1)),e("div",re,[n(p,null,{default:r(()=>[n(v,{filled:"",modelValue:B.value,"onUpdate:modelValue":l[2]||(l[2]=t=>B.value=t),label:"Billet surface area price (per sq in)",onInput:W},null,8,["modelValue"])]),_:1}),n(p,null,{default:r(()=>[n(v,{filled:"",modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=t=>_.value=t),label:"Material price per lb",onInput:J},null,8,["modelValue"])]),_:1}),n(p,null,{default:r(()=>[n(v,{filled:"",modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=t=>k.value=t),label:"Material markup (multiple)",onInput:$},null,8,["modelValue"])]),_:1}),n(p,null,{default:r(()=>[n(v,{filled:"",modelValue:U.value,"onUpdate:modelValue":l[5]||(l[5]=t=>U.value=t),label:"Setup price",onInput:j},null,8,["modelValue"])]),_:1}),n(p,null,{default:r(()=>[n(v,{filled:"",modelValue:M.value,"onUpdate:modelValue":l[6]||(l[6]=t=>M.value=t),label:"Shipping (est)",onInput:G},null,8,["modelValue"])]),_:1})])]),n(C),e("div",se,[n(ee,{label:"Part Surface Area Price Table","expand-separator":""},{default:r(()=>[i.value.length?(m(),A("div",ie,[n(F,null,{default:r(()=>[l[10]||(l[10]=e("thead",null,[e("tr",null,[e("th",null,"Square Inches"),e("th",null,"Price")])],-1)),e("tbody",null,[(m(!0),A(ne,null,ue(i.value,(t,c)=>(m(),A("tr",{key:c},[e("td",null,s(t[0]),1),e("td",null,s(t[1]),1)]))),128))])]),_:1})])):D("",!0),e("div",de,[n(q,{outlined:"",modelValue:V.value,"onUpdate:modelValue":[l[7]||(l[7]=t=>V.value=t),l[8]||(l[8]=t=>O())],label:"Update Price Table"},{prepend:r(()=>[n(Q,{name:"attach_file"})]),_:1},8,["modelValue"]),n(E,{onClick:H,label:"Export CSV"})])]),_:1})]),n(C),e("div",ce,[n(E,{type:"submit",loading:T.value,label:"Calculate"},null,8,["loading"])])]),_:1}),n(C),e("div",pe,[l[12]||(l[12]=e("label",{class:"part-details-label"},"Part Details",-1)),n(F,null,{default:r(()=>[l[11]||(l[11]=e("thead",null,[e("tr",null,[e("th",null,"Total Bounding box area"),e("th",null,"Final part Total Surface area"),e("th",null,"Bounding box area cost"),e("th",null,"Part Surface area cost"),e("th",null,"Billet weight (lbs)"),e("th",null,"Part weight (lbs)"),e("th",null,"Weight ratio")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,s(d.value.totalBoundingBoxArea),1),e("td",null,s(d.value.finalPartTotalSurfaceArea),1),e("td",null,s(o(d.value.boundingBoxAreaCost)),1),e("td",null,s(o(d.value.partSurfaceAreaCost)),1),e("td",null,s(d.value.billetWeight),1),e("td",null,s(d.value.partWeight),1),e("td",null,s(d.value.weightRatio),1)])])]),_:1})]),n(C),e("div",ve,[l[14]||(l[14]=e("label",{class:"price-outputs-label"},"Price Outputs",-1)),n(F,null,{default:r(()=>[l[13]||(l[13]=e("thead",null,[e("tr",null,[e("th",null,"Price per sq in"),e("th",null,"Machining Total"),e("th",null,"Material Total"),e("th",null,"Total Price")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,s(o(h.value.pricePerSqIn)),1),e("td",null,s(o(h.value.machiningTotal)),1),e("td",null,s(o(h.value.materialTotal)),1),e("td",null,s(o(h.value.totalPrice)),1)])])]),_:1})]),x.value?(m(),A("div",me,[l[15]||(l[15]=e("label",{class:"image-preview-label"},"Generated Image",-1)),e("img",{src:x.value,alt:"Generated Preview",class:"generated-image"},null,8,fe)])):D("",!0)])]),_:1}))}},Ae=X(ge,[["__scopeId","data-v-443cbc09"]]);export{Ae as default};
