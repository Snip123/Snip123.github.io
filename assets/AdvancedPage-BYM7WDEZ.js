import{u as he,f as xe,d as Ce,h as Ve,Q as q,e as H}from"./QBtn-lhrSOQ01.js";import{u as Ie,h as Ae,_ as De,Q as Fe,P as ie,a as we,b as re,c as Y,d as W,e as ee,f as Te,g as se}from"./_plugin-vue_export-helper-Chy9nbQs.js";import{u as Be,a as Ne}from"./QItem-CwVLnVv0.js";import{r as s,a as y,h as M,g as qe,W as z,s as ue,c as Me,F as Re,w as te,o as Ue,I as ce,J as S,K as _,V as a,M as i,R as V,L as N,S as ae,T as de,O as c,X as Ee,Y as Oe,N as C,Z as $e}from"./index-DoHF1jaR.js";import{a as je}from"./index-BtuGy7By.js";function Qe(d,R){const l=s(null),P=y(()=>d.disable===!0?null:M("span",{ref:l,class:"no-outline",tabindex:-1}));function h(v){const k=R.value;v?.qAvoidFocus!==!0&&(v?.type.indexOf("key")===0?document.activeElement!==k&&k?.contains(document.activeElement)===!0&&k.focus():l.value!==null&&(v===void 0||k?.contains(v.target)===!0)&&l.value.focus())}return{refocusTargetEl:P,refocusTarget:h}}const Le={xs:30,sm:35,md:40,lg:50,xl:60},We={...Be,...he,...Ie,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:d=>d==="tf"||d==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},ze=["update:modelValue"];function Ye(d,R){const{props:l,slots:P,emit:h,proxy:v}=qe(),{$q:k}=v,w=Ne(l,k),A=s(null),{refocusTargetEl:U,refocusTarget:E}=Qe(l,A),O=xe(l,Le),g=y(()=>l.val!==void 0&&Array.isArray(l.modelValue)),x=y(()=>{const o=z(l.val);return g.value===!0?l.modelValue.findIndex(I=>z(I)===o):-1}),p=y(()=>g.value===!0?x.value!==-1:z(l.modelValue)===z(l.trueValue)),D=y(()=>g.value===!0?x.value===-1:z(l.modelValue)===z(l.falseValue)),T=y(()=>p.value===!1&&D.value===!1),b=y(()=>l.disable===!0?-1:l.tabindex||0),X=y(()=>`q-${d} cursor-pointer no-outline row inline no-wrap items-center`+(l.disable===!0?" disabled":"")+(w.value===!0?` q-${d}--dark`:"")+(l.dense===!0?` q-${d}--dense`:"")+(l.leftLabel===!0?" reverse":"")),Z=y(()=>{const o=p.value===!0?"truthy":D.value===!0?"falsy":"indet",I=l.color!==void 0&&(l.keepColor===!0||p.value===!0)?` text-${l.color}`:"";return`q-${d}__inner relative-position non-selectable q-${d}__inner--${o}${I}`}),m=y(()=>{const o={type:"checkbox"};return l.name!==void 0&&Object.assign(o,{".checked":p.value,"^checked":p.value===!0?"checked":void 0,name:l.name,value:g.value===!0?l.val:l.trueValue}),o}),B=Ae(m),$=y(()=>{const o={tabindex:b.value,role:"switch","aria-label":l.label,"aria-checked":T.value===!0?"mixed":p.value===!0?"true":"false"};return l.disable===!0&&(o["aria-disabled"]="true"),o});function F(o){o!==void 0&&(ue(o),E(o)),l.disable!==!0&&h("update:modelValue",j(),o)}function j(){if(g.value===!0){if(p.value===!0){const o=l.modelValue.slice();return o.splice(x.value,1),o}return l.modelValue.concat([l.val])}if(p.value===!0){if(l.toggleOrder!=="ft"||l.toggleIndeterminate===!1)return l.falseValue}else if(D.value===!0){if(l.toggleOrder==="ft"||l.toggleIndeterminate===!1)return l.trueValue}else return l.toggleOrder!=="ft"?l.trueValue:l.falseValue;return l.indeterminateValue}function Q(o){(o.keyCode===13||o.keyCode===32)&&ue(o)}function L(o){(o.keyCode===13||o.keyCode===32)&&F(o)}const G=R(p,T);return Object.assign(v,{toggle:F}),()=>{const o=G();l.disable!==!0&&B(o,"unshift",` q-${d}__native absolute q-ma-none q-pa-none`);const I=[M("div",{class:Z.value,style:O.value,"aria-hidden":"true"},o)];U.value!==null&&I.push(U.value);const J=l.label!==void 0?Ce(P.default,[l.label]):Ve(P.default);return J!==void 0&&I.push(M("div",{class:`q-${d}__label q-anchor--skip`},J)),M("div",{ref:A,class:X.value,...$.value,onClick:F,onKeydown:Q,onKeyup:L},I)}}const Je=Me({name:"QToggle",props:{...We,icon:String,iconColor:String},emits:ze,setup(d){function R(l,P){const h=y(()=>(l.value===!0?d.checkedIcon:P.value===!0?d.indeterminateIcon:d.uncheckedIcon)||d.icon),v=y(()=>l.value===!0?d.iconColor:null);return()=>[M("div",{class:"q-toggle__track"}),M("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},h.value!==void 0?[M(q,{name:h.value,color:v.value})]:void 0)]}return Ye("toggle",R)}}),Ke={class:"price-inputs"},Xe={class:"price-inputs-group"},Ze={class:"csv-upload"},Ge={key:0,class:"csv-table"},He={class:"csv-buttons"},et={class:"calculate-button"},tt={key:0,class:"current-file"},at={class:"output-section"},lt=["src","onClick"],nt={class:"summary-text truncated"},ot={key:0,class:"expanded-row"},it={colspan:"11"},rt={key:0,class:"expanded-content"},st={class:"summary-text truncated"},ut={class:"summary-text truncated"},ct={class:"summary-text truncated"},dt=["src"],pt={class:"export-controls"},mt={__name:"AdvancedPage",setup(d){const l=je.create({baseURL:"http://20.55.98.16:8080/"}),P=s(1.4),h=s(4.2),v=s(4),k=s(50),w=s(21),A=s([]),U=s(""),E=s(!1),O=s(),g=s([]),x=s([]),p=s([]),D=s(null),T=s(!0),b=Re([]),X=()=>{console.log("files uploaded:",A.value)},Z=()=>{if(console.log("csv uploaded"),O.value){const n=new FileReader;n.onload=e=>{const t=e.target.result;ie.parse(t,{header:!0,skipEmptyLines:!0,complete:u=>{g.value=u.data.map(f=>[f["Square Inches"],f.Price])}})},n.readAsText(O.value),console.log(g.value)}},m=n=>n?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n):"",B=n=>n?parseFloat(n.replace(/[^0-9.-]+/g,"")):0,$=s(m(P.value)),F=s(m(h.value)),j=s(v.value),Q=s(m(k.value)),L=s(m(w.value)),G=n=>{console.log("updating billet surface area price"),P.value=B(n),$.value=m(P.value)},o=n=>{h.value=B(n),F.value=m(h.value)},I=n=>{v.value=parseFloat(n),j.value=v.value},J=n=>{k.value=B(n),Q.value=m(k.value)},pe=n=>{w.value=B(n),L.value=m(w.value)},me=n=>n.aiDescription.manufacturing_considerations.likely_single_setup?n.aiDescription.pricing_impact.likely_price_impact||n.aiDescription.customer_notification.likely_customer_notification?"warning":"check_circle":"cancel",fe=n=>n.aiDescription.manufacturing_considerations.likely_single_setup?n.aiDescription.pricing_impact.likely_price_impact||n.aiDescription.customer_notification.likely_customer_notification?"icon-warning":"icon-success":"icon-error",ve=n=>{p.value.includes(n)?p.value=p.value.filter(e=>e!==n):p.value.push(n)},ge=n=>{D.value=n},le=()=>{D.value=null},be=n=>{const e=B(b[n]);b[n]=isNaN(e)?0:e};te(()=>x.value,n=>{n.forEach((e,t)=>{b[t]===void 0&&(b[t]=0)})},{immediate:!0});const ne=()=>{x.value=[],p.value=[],b.splice(0,b.length)};te([$,F,j,Q,L],()=>{ne()}),te(g,()=>{ne()});const _e=async()=>{if(!A.value.length){console.error("No files to analyze.");return}E.value=!0;for(const n of A.value){U.value=n.name;try{const e=new FormData;e.append("billetSurfaceAreaPrice",P.value),e.append("surfaceAreaPriceTable",JSON.stringify(g.value)),e.append("materialPricePerLb",h.value),e.append("materialMarkup",v.value),e.append("setupPrice",k.value),e.append("shippingEst",w.value),e.append("stepFile",n);const t=await l.post("/advanced_calculations",e,{headers:{"Content-Type":"multipart/form-data"}}),u={fileName:n.name,base64Image:t.data.preview_image?`data:image/png;base64,${t.data.preview_image}`:null,aiDescription:JSON.parse(t.data.ai_description),priceOutputs:{pricePerSqIn:t.data.part_surface_area_price.toFixed(2),machiningTotal:t.data.machining_cost.toFixed(2),materialTotal:t.data.material_price.toFixed(2),totalPrice:t.data.total_price.toFixed(2)},partDetails:{billetWeight:t.data.billet_weight.toFixed(2),boundingBoxAreaCost:t.data.bounding_box_area_cost.toFixed(2),boundingBoxSurfaceArea:t.data.bounding_box_surface_area.toFixed(2),partSurfaceArea:t.data.part_surface_area.toFixed(2),partSurfaceAreaCost:t.data.part_surface_area_cost.toFixed(2),partWeight:t.data.part_weight.toFixed(2),weightRatio:t.data.weight_ratio.toFixed(2)}},f=x.value.findIndex(r=>r.fileName===n.name);f!==-1?x.value[f]=u:x.value.push(u)}catch(e){console.error(`Error analyzing file ${n.name}:`,e)}}U.value="",E.value=!1},ye=()=>{ie.parse(`1,4.55
5,4.55
10,4.52
15,4.37
20,4.07
25,3.72
30,3.42
35,3.12
40,2.82
45,2.52
50,2.22
55,1.92
60,1.62
65,1.32
70,1.12
75,0.92
80,0.72
85,0.62
90,0.57
95,0.56
100,0.55
105,0.54
110,0.53
115,0.52
120,0.51
125,0.50
130,0.49
135,0.48
140,0.47
145,0.47
150,0.47
155,0.47
160,0.47
165,0.47
170,0.47
175,0.47
180,0.47
185,0.47
190,0.47
195,0.47
200,0.47`,{complete:e=>{g.value=e.data}})},ke=()=>{const n=`data:text/csv;charset=utf-8,Square Inches,Price
`+g.value.map(u=>u.join(",")).join(`
`),e=encodeURI(n),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","price_table.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},Se=()=>{const n=["File Name","Price per sq in","Machining Total","Material Total","Setup Price","Shipping Estimate","Price Adjustment","Adjusted Total Price","Bounding Box Surface Area","Bounding Box Area Cost","Part Surface Area","Part Surface Area Cost","Billet Weight","Part Weight","Weight Ratio","Likely Single Setup","Likely Price Impact","Likely Customer Notification",...T.value?["Part Summary","Manufacturing Considerations","Pricing Impact","Customer Notification"]:[]],e=x.value.map((r,K)=>{const Pe=parseFloat(r.priceOutputs.totalPrice)+parseFloat(b[K]||0),oe=[r.fileName,r.priceOutputs.pricePerSqIn,r.priceOutputs.machiningTotal,r.priceOutputs.materialTotal,k.value,w.value,b[K]||0,Pe,r.partDetails.boundingBoxSurfaceArea,r.partDetails.boundingBoxAreaCost,r.partDetails.partSurfaceArea,r.partDetails.partSurfaceAreaCost,r.partDetails.billetWeight,r.partDetails.partWeight,r.partDetails.weightRatio,r.aiDescription.manufacturing_considerations.likely_single_setup?"Yes":"No",r.aiDescription.pricing_impact.likely_price_impact?"Yes":"No",r.aiDescription.customer_notification.likely_customer_notification?"Yes":"No"];return T.value&&oe.push(r.aiDescription.part_summary,r.aiDescription.manufacturing_considerations.summary,r.aiDescription.pricing_impact.summary,r.aiDescription.customer_notification.summary),oe}),t="data:text/csv;charset=utf-8,"+[n.join(","),...e.map(r=>r.map(K=>`"${K}"`).join(","))].join(`
`),u=encodeURI(t),f=document.createElement("a");f.setAttribute("href",u),f.setAttribute("download","analysis_results.csv"),document.body.appendChild(f),f.click(),document.body.removeChild(f)};return Ue(()=>{ye()}),(n,e)=>(S(),ce(Fe,{class:"flex flex-center page-container"},{default:_(()=>[a("div",null,[i(we,{onSubmit:_e},{default:_(()=>[i(re,{outline:"",multiple:"",modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=t=>A.value=t),label:"Upload .STEP files",onChange:e[1]||(e[1]=t=>X())},{prepend:_(()=>[i(q,{name:"attach_file"})]),_:1},8,["modelValue"]),a("div",Ke,[e[11]||(e[11]=a("label",{class:"price-inputs-label"},"Advanced Price Inputs",-1)),a("div",Xe,[i(Y,null,{default:_(()=>[i(W,{filled:"",modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=t=>$.value=t),label:"Billet surface area price (per sq in)",onInput:G},null,8,["modelValue"])]),_:1}),i(Y,null,{default:_(()=>[i(W,{filled:"",modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=t=>F.value=t),label:"Material price per lb",onInput:o},null,8,["modelValue"])]),_:1}),i(Y,null,{default:_(()=>[i(W,{filled:"",modelValue:j.value,"onUpdate:modelValue":e[4]||(e[4]=t=>j.value=t),label:"Material markup (multiple)",onInput:I},null,8,["modelValue"])]),_:1}),i(Y,null,{default:_(()=>[i(W,{filled:"",modelValue:Q.value,"onUpdate:modelValue":e[5]||(e[5]=t=>Q.value=t),label:"Setup price",onInput:J},null,8,["modelValue"])]),_:1}),i(Y,null,{default:_(()=>[i(W,{filled:"",modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=t=>L.value=t),label:"Shipping (est)",onInput:pe},null,8,["modelValue"])]),_:1})])]),i(ee),a("div",Ze,[i(Te,{label:"Part Surface Area Price Table","expand-separator":""},{default:_(()=>[g.value.length?(S(),V("div",Ge,[i(se,null,{default:_(()=>[e[12]||(e[12]=a("thead",null,[a("tr",null,[a("th",null,"Square Inches"),a("th",null,"Price")])],-1)),a("tbody",null,[(S(!0),V(ae,null,de(g.value,(t,u)=>(S(),V("tr",{key:u},[a("td",null,c(t[0]),1),a("td",null,c(t[1]),1)]))),128))])]),_:1})])):N("",!0),a("div",He,[i(re,{outlined:"",modelValue:O.value,"onUpdate:modelValue":[e[7]||(e[7]=t=>O.value=t),e[8]||(e[8]=t=>Z())],label:"Update Price Table"},{prepend:_(()=>[i(q,{name:"attach_file"})]),_:1},8,["modelValue"]),i(H,{onClick:ke,label:"Export CSV"})])]),_:1})]),i(ee),a("div",et,[i(H,{type:"submit",loading:E.value,label:"Calculate"},null,8,["loading"]),E.value?(S(),V("span",tt,"Analyzing: "+c(U.value),1)):N("",!0)])]),_:1}),i(ee),a("div",at,[e[28]||(e[28]=a("label",{class:"output-section-label"},"Analysis Results",-1)),i(se,{class:"analysis-table"},{default:_(()=>[e[27]||(e[27]=a("thead",null,[a("tr",null,[a("th"),a("th"),a("th",null,"File Name"),a("th",null,"Part Image"),a("th",null,"Part Summary"),a("th",null,"Price per sq in"),a("th",null,"Machining Total"),a("th",null,"Material Total"),a("th",null,"Price Adjustment"),a("th",null,"Total Price"),a("th")])],-1)),a("tbody",null,[(S(!0),V(ae,null,de(x.value,(t,u)=>(S(),V(ae,{key:u},[a("tr",null,[a("td",null,[i(q,{name:p.value.includes(u)?"keyboard_arrow_down":"keyboard_arrow_right",class:"expand-icon",onClick:f=>ve(u)},null,8,["name","onClick"])]),a("td",null,[i(q,{name:me(t),class:Ee([fe(t),"status-icon"])},null,8,["name","class"])]),a("td",null,c(t.fileName),1),a("td",null,[t.base64Image?(S(),V("img",{key:0,src:t.base64Image,alt:"Part Image",class:"part-image",onClick:f=>ge(t.base64Image)},null,8,lt)):N("",!0)]),a("td",null,[a("span",nt,c(t.aiDescription.part_summary),1)]),a("td",null,c(m(t.priceOutputs.pricePerSqIn)),1),a("td",null,c(m(t.priceOutputs.machiningTotal)),1),a("td",null,c(m(t.priceOutputs.materialTotal)),1),a("td",null,[i(W,{modelValue:b[u],"onUpdate:modelValue":f=>b[u]=f,type:"text",outlined:"",dense:"",onInput:f=>be(u)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",null,c(m(parseFloat(t.priceOutputs.totalPrice)+parseFloat(b[u]||0))),1),a("td",null,[t.aiDescription.customer_notification.likely_customer_notification?(S(),ce(q,{key:0,name:"contact_mail",class:"icon-notification"})):N("",!0)])]),p.value.includes(u)?(S(),V("tr",ot,[a("td",it,[i(Oe,{name:"expand"},{default:_(()=>[p.value.includes(u)?(S(),V("div",rt,[a("p",null,[e[13]||(e[13]=a("strong",null,"Features on 6 Sides:",-1)),C(" "+c(t.aiDescription.features_on_6_sides?"Yes":"No"),1)]),a("p",null,[e[14]||(e[14]=a("strong",null,"Manufacturing Considerations:",-1)),e[15]||(e[15]=C()),a("span",st,c(t.aiDescription.manufacturing_considerations.summary),1)]),a("p",null,[e[16]||(e[16]=a("strong",null,"Pricing Impact:",-1)),e[17]||(e[17]=C()),a("span",ut,c(t.aiDescription.pricing_impact.summary),1)]),a("p",null,[e[18]||(e[18]=a("strong",null,"Customer Notification:",-1)),e[19]||(e[19]=C()),a("span",ct,c(t.aiDescription.customer_notification.summary),1)]),a("p",null,[e[20]||(e[20]=a("strong",null,"Bounding Box Surface Area:",-1)),C(" "+c(t.partDetails.boundingBoxSurfaceArea)+" sq in",1)]),a("p",null,[e[21]||(e[21]=a("strong",null,"Bounding Box Area Cost:",-1)),C(" "+c(m(t.partDetails.boundingBoxAreaCost)),1)]),a("p",null,[e[22]||(e[22]=a("strong",null,"Part Surface Area:",-1)),C(" "+c(t.partDetails.partSurfaceArea)+" sq in",1)]),a("p",null,[e[23]||(e[23]=a("strong",null,"Part Surface Area Cost:",-1)),C(" "+c(m(t.partDetails.partSurfaceAreaCost)),1)]),a("p",null,[e[24]||(e[24]=a("strong",null,"Billet Weight:",-1)),C(" "+c(t.partDetails.billetWeight)+" lbs",1)]),a("p",null,[e[25]||(e[25]=a("strong",null,"Part Weight:",-1)),C(" "+c(t.partDetails.partWeight)+" lbs",1)]),a("p",null,[e[26]||(e[26]=a("strong",null,"Weight Ratio:",-1)),C(" "+c(t.partDetails.weightRatio),1)])])):N("",!0)]),_:2},1024)])])):N("",!0)],64))),128))])]),_:1}),D.value?(S(),V("div",{key:0,class:"image-popup-overlay",onClick:le},[a("div",{class:"image-popup-content",onClick:e[9]||(e[9]=$e(()=>{},["stop"]))},[i(q,{name:"close",class:"popup-close-icon",onClick:le}),a("img",{src:D.value,alt:"Full Resolution Part Image",class:"popup-image"},null,8,dt)])])):N("",!0),a("div",pt,[i(H,{label:"Export Analysis Results",onClick:Se}),i(Je,{modelValue:T.value,"onUpdate:modelValue":e[10]||(e[10]=t=>T.value=t),label:"Include Summaries"},null,8,["modelValue"])])])])]),_:1}))}},yt=De(mt,[["__scopeId","data-v-08a0eec8"]]);export{yt as default};
